<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>WebSockets Post</title>
  </head>

  <body>
    <h1>WebSockets Post</h1>
    <ol>
      <li>Connect to wss://<span id="host">[host]</span>:[port]/[user_id]</li>
      <li>
        Send message <code>{ to: [some_user_id], data: [some_data] }</code>
      </li>
    </ol>
    <span id="test"></span>
    <script>
      document.getElementById('host').innerHTML = location.host;
      const protocol = location.protocol.replace('http', 'ws');
      const testmessage = JSON.stringify({ from: '1', to: '2', data: 'ololo' });
      const socket1 = new WebSocket(protocol + '//' + location.host + '/1');
      const socket2 = new WebSocket(protocol + '//' + location.host + '/2');
      socket2.onmessage = function(message) {
        if (testmessage == message.data) {
          document.getElementById('test').innerHTML = 'All ok';
        } else {
          console.log(message);
          document.getElementById('test').innerHTML = 'Something wrong...';
        }
        socket1.close();
        socket2.close();
      };
      socket1.onopen = function() {
        socket1.send(testmessage);
      };
    </script>
  </body>
</html>
