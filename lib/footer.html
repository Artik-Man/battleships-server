</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/javascript.min.js"></script>
<script>
    (() => {
        const protocol = location.protocol.replace('http', 'ws');

        async function setAddress() {
            document.getElementById('protocol').innerHTML = protocol;
            document.getElementById('host').innerHTML = location.host;
        }

        function checkWS() {
            const testHtml = document.getElementById('test');
            const timeout = setTimeout(() => {
                testHtml.innerHTML = 'Connection timeout';
            }, 30000);
            const socket = new WebSocket(protocol + '//' + location.host);
            let id;
            let connections = [];

            socket.onmessage = function (msg) {
                const message = JSON.parse(msg.data);
                clearTimeout(timeout);
                if (message.error) {
                    testHtml.innerHTML = message.error;
                } else if (message.from === 'SERVER') {
                    id = message.to;
                    console.log('ID: ' + id);
                    if (message.data && message.data.connections) {
                        connections = message.data.connections;
                        console.log('USERS:', connections);
                    }
                    testHtml.innerHTML = 'Server works ok';
                } else if (message.status === 200) {
                    console.log('new message:', message.data);
                } else {
                    console.warn(message.data);
                }
                socket.close();
            }
            socket.onerror = function (error) {
                console.warn(error);
                testHtml.innerHTML = 'Something wrong...';
                clearTimeout(timeout);
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            setAddress();
            checkWS();
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    })();
</script>
</body>

</html>